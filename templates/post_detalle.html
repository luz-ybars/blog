{% extends 'base.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% load colab_tags %}

{% block title %}{{ post.titulo }}{% endblock %}

{% block contenido %}
<div class="container py-5">
  <!-- Título del post -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-start">
        <div class="flex-grow-1">
          <h1 class="display-4 text-primary mb-3">{{ post.titulo }}</h1>
          <p class="post-meta text-muted mb-2 fs-5">
            <i class="fas fa-calendar me-2"></i>Publicado el {{ post.fch_publicacion|date:"d/m/Y H:i" }}
            <i class="fas fa-user ms-3 me-2"></i>por {{ post.autor }}
          </p>
          {% if post.categorias.all %}
          <div class="mb-0">
            {% for categoria in post.categorias.all %}
              <span class="badge bg-primary me-1">{{ categoria.nombre }}</span>
            {% endfor %}
          </div>
          {% endif %}
        </div>
        {% if user|es_colaborador %}
          <div class="btn-group ms-3">
            <a href="{% url 'post_editar' post.id %}" class="btn btn-warning">
              <i class="fas fa-edit me-1"></i>Editar
            </a>
            <a href="{% url 'post_eliminar' post.id %}" class="btn btn-danger">
              <i class="fas fa-trash me-1"></i>Eliminar
            </a>
          </div>
        {% endif %}
      </div>
    </div>
  </div>

  <!-- Contenido del post con imagen a la derecha -->
  <div class="row">
    <div class="col-lg-8">
      <div class="post-content-wrapper">
        <div class="post-content">
          {{ post.contenido|linebreaks }}
        </div>
      </div>
    </div>
    {% if post.imagen %}
    <div class="col-lg-4">
      <div class="post-image-wrapper text-center">
        <img src="{{ post.imagen.url }}" class="img-fluid rounded shadow-sm" alt="{{ post.titulo }}" style="max-width: 100%; height: auto; object-fit: contain;">
      </div>
    </div>
    {% endif %}
  </div>

  <!-- Sección de comentarios -->
  <div class="row mt-5">
    <div class="col-12">
      <section class="comments-section">
        <div class="card border-0 shadow-sm">
          <div class="card-header bg-light p-3">
            <h2 class="h4 text-primary mb-0">
              <i class="fas fa-comments me-2"></i>Comentarios ({{ comentarios.count }})
            </h2>
          </div>
          {% if comentarios %}
            <ul class="list-group list-group-flush">
              {% for comentario in comentarios %}
                <li class="list-group-item d-flex justify-content-between align-items-start border-0 border-bottom p-4">
                  <div class="flex-grow-1">
                    <h5 class="autor_comentario mb-2">{{ comentario.autor_comentario.get_full_name|default:comentario.autor_comentario }}</h5>
                    <p class="comentario-content mb-2">{{ comentario.contenido_comentario }}</p>
                    <small class="text-muted">{{ comentario.fch_creacion_comentario|timesince }}</small>
                  </div>
                  {% if request.user == comentario.autor_comentario %}
                    <a href="{% url 'eliminar_comentario' comentario.pk %}" class="btn btn-sm btn-danger ms-3" title="Eliminar Comentario">
                      <i class="fas fa-trash"></i>
                    </a>
                  {% endif %}
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <div class="card-body p-4">
              <p class="text-muted text-center mb-0">No hay comentarios aún. ¡Sé el primero en comentar!</p>
            </div>
          {% endif %}
        </div>
      </section>
    </div>
  </div>

  <!-- Formulario de comentarios -->
  <div class="row mt-4">
    <div class="col-12">
      <section class="comment-form-section">
        <div class="card border-0 shadow-sm">
          <div class="card-header bg-light p-3">
            <h2 class="h4 text-primary mb-0">
              <i class="fas fa-paper-plane me-2"></i>Deja un comentario
            </h2>
          </div>
          <div class="card-body p-4">
            <form method="post" action="{% url 'post_detalle' post.pk %}">
              {% csrf_token %}
              {{ form|crispy }}
              <div class="d-grid mt-3">
                <button type="submit" class="btn btn-primary">
                  <i class="fas fa-paper-plane me-2"></i>Comentar
                </button>
              </div>
            </form>
          </div>
        </div>
      </section>
    </div>
  </div>
    </div>
  </div>
</div>
{% endblock %}
 

